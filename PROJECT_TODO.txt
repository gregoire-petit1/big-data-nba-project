Big Data Project - Build Plan (Spark + NBA)

Decisions locked
- Theme: NBA
- Sources: balldontlie + TheSportsDB
- Seasons: last 3 seasons
- Refresh: daily (no realtime)
- Storage: MinIO (S3 compatible)
- Spark for formatting/combination/ML
- Two Elasticsearch indices: nba_team_metrics, nba_match_metrics
- Dashboard: team view + match view with season/team/date filters

Data lake naming
- data/<layer>/nba/<source>/<entity>/dt=YYYY-MM-DD/
- Layers: raw, formatted, combined

File structure to create
- docker-compose.yml
- .env.example
- ingestion/ingest_balldontlie.py
- ingestion/ingest_thesportsdb.py
- jobs/format_balldontlie.py
- jobs/format_thesportsdb.py
- jobs/combine_metrics.py
- jobs/train_predict.py
- jobs/index_team_metrics.py
- jobs/index_match_metrics.py
- dags/nba_pipeline_dag.py

Execution checklist
[ ] 1) Docker stack
    - Airflow (webserver, scheduler, postgres)
    - Spark (master, worker)
    - MinIO (S3)
    - Elasticsearch + Kibana
    - Volumes, networks, healthchecks

[ ] 2) Config and secrets
    - Create .env from .env.example
    - Add THESPORTSDB_API_KEY
    - Set MinIO credentials and endpoint
    - Set Elasticsearch host/port

[ ] 3) Ingestion (raw)
    - balldontlie: games, teams for 3 seasons
    - TheSportsDB: teams (includes venue fields)
    - Write JSON to MinIO raw layer

[ ] 4) Formatting (Spark -> parquet)
    - Clean types
    - Normalize team names
    - Convert dates to UTC
    - Write to formatted layer

[ ] 5) Combination (Spark)
    - Join teams + games
    - Compute KPIs (last5, rest_days, home/away)
    - Write combined/team_metrics and combined/match_metrics

[ ] 6) ML (Spark ML)
    - Label: home win (1/0)
    - Features: KPIs + rest_days + home/away
    - Model: Logistic Regression
    - Add win_probability_home to match_metrics

[ ] 7) Indexing
    - Index team_metrics to nba_team_metrics
    - Index match_metrics to nba_match_metrics

[ ] 8) Airflow DAG
    - Single DAG with daily schedule
    - Order: ingest -> format -> combine -> train/predict -> index

[ ] 9) Dashboard (Kibana)
    - Index patterns: nba_team_metrics, nba_match_metrics
    - Filters: season, team, date
    - Visuals: win_rate_last5, avg_points_last5, home_away_diff, win_probability_home

[ ] 10) Run-all validation
    - docker-compose up
    - Trigger DAG once
    - Verify raw/formatted/combined in MinIO
    - Verify Elasticsearch indices + Kibana dashboard

Deliverables
[ ] PDF (<=10 pages): architecture, data lake, DAG, Spark jobs, KPIs, ML, dashboard
[ ] Video (<=10 min): demo pipeline + dashboard
[ ] ZIP: full code + instructions
